<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no, width=device-width">

    <link href="css/ionic.app.css" rel="stylesheet">

</head>
<body>
<h1>Compile doesn't work </h1>

<div ng-controller="demoCtrl" ng-app="demoApp" id="ng-app">
    <pre>$scope.personId = {{selectedPersonId}}</pre>
    <my-person-lookup style="width:200px" people="people"></my-person-lookup>
</div>
<script src="bower_components/requirejs/require.js"></script>


<script>

    window.name = "NG_DEFER_BOOTSTRAP!";

    require.config({
        baseUrl: 'js/',
        paths: {

            'angular': '../bower_components/angular/angular',
            'angular-animate': '../bower_components/angular-animate/angular-animate',
            'angular-sanitize': '../bower_components/angular-sanitize/angular-sanitize',
            'angular-ui-router': '../bower_components/angular-ui-router/release/angular-ui-router',
            'ui-bootstrap' : '../lib/ui-bootstrap-custom',
            'ui-bootstrap-tpls' : '../lib/ui-bootstrap-custom-tpls'
        },
        shim: {
            'angular' :{exports:'angular'},
            'ui-bootstrap' : ['angular'],
            'ui-bootstrap-tpls' : ['angular', 'ui-bootstrap']
        }
    });

    require(['angular', 'ui-bootstrap', 'ui-bootstrap-tpls'], function(angular) {

        'use strict';

        angular.module('demoApp', ['ui.bootstrap'])
                .controller("demoCtrl", function($scope) {

                    $scope.people = [
                        {name: 'Person_111', value: 111},
                        {name: 'Person_222', value: 222},
                        {name: 'Person_333', value: 333}
                    ];

                    $scope.selectPerson = function(val) {
                        $scope.selectedPersonId = val;
                    };
                })
                .directive("myPersonLookup", function($compile) {

                    function linker(scope, element, attrs, wrappingController) {
                        var html = '<input type="text" ng-model="selectedPerson" typeahead=" p as p.name for p in people" typeahead-min-length="1" typeahead-wait-ms="200" typeahead-editable="false" placeholder="type p"></input>';
                        element.html(html);
                        $compile(element.contents())(scope);
                    }

                    return {
                        restrict: 'E',
                        scope: {
                            selectedPerson: '&',
                            people : '='
                        },
                        require: "^ngController",
                        link: linker
                    };
                });

        var $html = angular.element(document.getElementsByTagName('html')[0]);

        $html.ready(function() {
            angular.resumeBootstrap(['demoApp']);
        });
    });

</script>
</body>
</html>